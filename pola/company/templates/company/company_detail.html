{%extends 'company/base.html' %}

{% load i18n humanize pola_extras %}

{% block css %}
    {{ block.super }}
    <style>
        :root {
            --pola-brand-primary: #d91330;
            --pola-brand-seconary: #c4c4c4;
        }
        .pola-app-company_card {
            display: flex;
            align-content: stretch;

            border: 1px solid #ccc;
            padding: 15px;
            margin: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            font-family: Arial, sans-serif;
        }

        .pola-app-company_card__rating-block {
            flex: 2;
        }
        .pola-app-company_card__stats-block {
            flex: 1;
        }
        .pola-app-company_card__rating-block,
        .pola-app-company_card__stats-block {
            margin-bottom: 20px;
            padding: 10px;
        }

        .pola-app-company_card__score {
            margin-bottom: 20px;
        }
        .pola-app-company_card__score > div:first-child {
            line-height: 22px;
            padding: 0;
            font-weight: 600;
        }

        .pola-app-company_card__criteria > div {
            margin-bottom: 15px;
            font-size: 16px;
        }

        .pola-app-company_card__stats-block {
            display: flex;
            flex-direction: column;
        }
        .pola-app-company_card__stats-block > div{
            flex: 1;
        }

        .pola-app-company_card__data-block {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-evenly;
            padding: 16px;
            background-color: var(--pola-brand-primary);
            color: white;
            margin-bottom: 5px;
            text-align: center;
        }

        .pola-app-company_card__data-block > div:first-child {
            font-weight: bold;
            font-size: 24px;
        }

        .pola-app-company_card__data-block > div:last-child {
            font-size: 16px;
        }

        .pola-app__score_bar {
            width: 100%;
            height: 26px;
            background-color: #ddd;
            border-radius: 5px;
            position: relative;
        }

        .pola-app__score_bar__score_bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: var(--pola-brand-primary);
        }

        .pola-app__score_bar__label {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            line-height: 26px;
            padding: 0 10px;
            color: rgba(0, 0, 0, .8);
            font-weight: 400;
        }

        .pola-app-checkmark {
            display: inline-block;
            height: 25px;
            width: 25px;
            background-color: rgb(160, 160, 160);
            vertical-align: middle;
            color: white;
            font-size: 25px;
            line-height: 25px;
        }
    </style>
{% endblock css %}

{% block breadcrumbs_rows %}
    <li class="active"><a href="{{ obj.get_absolute_url }}">{{ object }}</a></li>
{% endblock %}

{% block content %}
{% if user.is_authenticated %}
    <div class="btn-group">
        {% if perms.company.delete_company %}
            <a href="{% url 'company:delete' object.pk %}" class="btn btn-primary"><i class="fa fa-trash"></i> {% trans "Usuń" %}</a>
        {% endif %}
        {% if perms.company.change_company %}
            <a href="{% url 'company:edit' object.pk %}" class="btn btn-primary"><i class="fa fa-pencil"></i> {% trans "Zmień" %}</a>
        {% endif %}
    </div>
{% endif %}

{% if object.pl_score %}
    <div class="text-success text-right h3 pull-right">
        <i class="fa fa-check" title="Zweryfikowana firma"></i>
        {{ object.pl_score }}
    </div>
{% endif %}
<h1>
    {% if object.locked_by %}<i class="fa fa-lock" title="Edytowane przez: {{ object.locked_by }}"></i>{% endif %}
    {{ object }}  <small>#{{ object.pk }}</small>
</h1>
<div class="row">
    <div class="col-lg-9">
        <div class="panel panel-primary">
            <div class="panel-heading">{% trans "Data metric" %}</div>
            <table class="table">
                {% for field in fields %}
                <tr>
                    <td>{{ field.name }}</td><td>{{ field.value|linebreaksbr }}</td>
                </tr>
                {% endfor %}
                <tr>
                    <td>{% trans "Data utworzenia: " %}</td><td>{{ object.created | naturaltime }}</td>
                </tr>
                <tr>
                    <td>{% trans "Data modyfikacji: " %}</td><td>{{ object.modified | naturaltime }}</td>
                </tr>
            </table>
        </div>
    </div>
    <div class="col-lg-3">
        <div class="panel panel-info">
            <div class="panel-heading">
                <div class="panel-title">
                    Logotyp
                </div>
            </div>
            <div class="panel-body">
                {% if object.logotype %}
                    <img src="{{ object.logotype.url }}" class="img-responsive"/>
                {% else %}
                Brak logotypu
                {% endif %}
            </div>
        </div>
        <div class="panel panel-info">
            <div class="panel-heading">
                <div class="btn-group pull-right">
                    <a class="btn btn-xs btn-info" href="{% url "company:brand-list" %}?company={{ object.pk }}" title="Pokaż">
                        <i class="fa fa-eye"></i>
                    </a>
                    <a class="btn btn-xs btn-info" href="{% url "company:brand-create" %}?company={{ object.pk }}" title="Dodaj">
                        <i class="fa fa-plus"></i>
                    </a>
                </div>

                <h3 class="panel-title">Marki</h3>
            </div>

            {% if brand_list %}
            <ul class="list-group">
                {% for brand in brand_list %}
                <li class="list-group-item"><a href="{{ brand.get_absolute_url }}">{{ brand }}</a></li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="panel-body">
                {% trans "Nie ma żadnych marek" %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<div class="row">
    {% if perms.product.view_product %}
        <div class="col-md-6">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">Produkowane produkty</h3>
                </div>
                <table class="table" id="company-table">
                    {% for product in product_list %}
                        <tr>
                            <td>
                                <a href="{{ product.get_absolute_url }}">{{ product }}</a>
                            </td>
                            <td class="text-right">
                                <div>({{ product.query_count }})</div>
                            </td>
                        </tr>
                    {% empty%}
                        <tr>
                            <td>
                                {% trans "Nie ma żadnych produktów" %}
                            </td>
                        </tr>
                    {% endfor %}
                    </table>
                </ul>
            </div>
        </div>
    {% endif %}
    {% if perms.report.view_report %}
        <div class="col-md-6">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <a class="btn btn-xs btn-info pull-right" href="/cms/report/advanced/?status=open&product__company={{ object.pk }}">Pokaż wszystkie</a>
                    <h3 class="panel-title">Zgłoszenia powiązane przez produkty</h3>
                </div>
                {% if report_list %}
                    <ul class="list-group">
                        {% for report in report_list %}
                        <li class="list-group-item"><a href="{{ report.get_absolute_url }}">{{ report }}</a></li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <div class="panel-body">
                        {% trans "Nie ma żadnych zgłoszeń" %}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
</div>

<div class="panel panel-info">
    <div class="panel-heading">
        Karta firmy
    </div>
    <div class="panel-body">
        {% if company_card %}
        <div class="pola-app-company_card">
            <div class="pola-app-company_card__rating-block">
                <div class="pola-app-company_card__score">
                    <div>Punkty w rankingu Poli</div>
                    <div class="pola-app__score_bar">
                        <div class="pola-app__score_bar__score_bar" style="width: {{ company_card.pl_score }}%"></div>
                        <div class="pola-app__score_bar__label">{{ company_card.pl_score }} pkt</div>
                    </div>
                </div>
                <div class="pola-app-company_card__score">
                    <div>Udział polskiego kapitału:</div>
                    <div class="pola-app__score_bar">
                        <div class="pola-app__score_bar__score_bar" style="width: {{ company_card.pl_capital }}%"></div>
                        <div class="pola-app__score_bar__label">{{ company_card.pl_capital }} %</div>
                    </div>
                </div>
                <div class="pola-app-company_card__criteria">
                    <div>
                        <span class="pola-app-checkmark">
                            {% if company_card.pl_rnd %}
                                <i class="fa fa-check" aria-hidden="true"></i>
                            {% endif %}
                        </span>
                        produkuje w Polsce
                    </div>
                    <div>
                        <span class="pola-app-checkmark">
                            {% if company_card.pl_rnd %}
                                <i class="fa fa-check" aria-hidden="true"></i>
                            {% endif %}
                        </span>
                        prowadzi badania i rozwój w Polsce
                    </div>
                    <div>
                        <span class="pola-app-checkmark">
                            {% if company_card.pl_registered %}
                                <i class="fa fa-check" aria-hidden="true"></i>
                            {% endif %}
                        </span>
                        zarejestrowana w Polsce
                    </div>
                    <div>
                        <span class="pola-app-checkmark">
                            {% if company_card.pl_not_glob_ent %}
                                <i class="fa fa-check" aria-hidden="true"></i>
                            {% endif %}
                        </span>
                        nie jest częścią zagranicznego koncernu
                    </div>
                </div>
            </div>

            <div class="pola-app-company_card__stats-block">
                <div class="pola-app-company_card__data-block">
                    <div>{{ company_card.product_count }}</div>
                    <div>łączna liczba produktów firmy w bazie aplikacji Pola</div>
                </div>
                <div class="pola-app-company_card__data-block">
                    <div>{{ company_card.product_query_count | intspace }}</div>
                    <idv>łączna liczba skanowań produktów firmy za pomocą aplikacji Pola</idv>
                </div>
                <div class="pola-app-company_card__data-block">
                    <div>{{ company_card.most_popular_code }}</div>
                    <div>najczęściej skanowany kod kreskowy firmy</div>
                </div>
            </div>
        </div>
        {% else %}
            Firma nie jest zweryfikowana
        {% endif %}
    </div>
</div>

{% endblock content %}
